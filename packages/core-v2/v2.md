# Bloom Core V2

> Rebuilding Bloom from the ground up with event-driven architecture, framework-agnostic adapters, and better developer experience.

Date: October 2025
Status: Active Development

---

## What We Have

**Core Infrastructure:**
- Zod v4 schemas with metadata (User, Session, Storage types)
- Utilities (cookies, crypto with argon2id, framework-agnostic headers for 8 frameworks)
- Constants (session expiry, password length limits)

**Data Layer:**
- Database adapters (Drizzle, Kysely, Prisma, MongoDB)
- Storage implementations (Memory, Redis)

**Hook System:**
- Path-based before/after hooks for all auth routes
- Simple Map-based storage for O(1) lookups
- Hooks run before/after auth operations

**Handler Architecture:**
- Router with path matching and parameter extraction
- Web Standard Request/Response pattern
- Rate limiting (auto-detection, per-path rules, IP-based)

**Auth API (Complete):**
- POST /register, /login, /logout
- GET /session, /sessions
- DELETE /sessions/:id, /sessions
- POST /send-verification-email, /verify-email
- POST /request-password-reset, /reset-password
- Server-side `api.getSession()` for direct session access

**Tests:** 148 passing tests across 16 files

---

## What We Don't Have

Missing pieces (in build order):

- Plugin system (builds on event system and handler)
- Framework adapters (Next.js, Express, etc.)
- Client library (React, Vue, Svelte)

---

## Architecture Vision

### Session Caching

Reduce database queries with session caching:

```typescript
export const auth = bloomAuth({
  adapter: drizzleAdapter(db),
  storage: redisStorage(redis),
  session: {
    cookieCache: { maxAge: 300 }
  }
})
```

### Client Library

Framework-agnostic core with React/Vue/Svelte bindings:

```typescript
import { createAuthClient } from '@bloom/react'

const client = createAuthClient()
const { data: session } = client.useSession()
```

### Plugin System

Extend Bloom with custom endpoints and event handlers:

```typescript
const oauthPlugin: BloomPlugin = {
  id: 'oauth',
  endpoints: [
    {
      path: '/oauth/:provider',
      method: 'GET',
      handler: async (req) => Response.redirect(getAuthUrl(req.params.provider))
    }
  ]
}

export const auth = bloomAuth({
  adapter: drizzleAdapter(db),
  plugins: [oauthPlugin]
})
```